---
import { Image } from "astro:assets";
import { getCollection, getEntry } from "astro:content";
import {
  IconArrowsShuffle,
  IconHeart,
  IconPlayerPlay,
  IconPlayerSkipBack,
  IconPlayerSkipForward,
  IconRepeat,
  IconShoppingCart,
  IconVolume,
} from "@tabler/icons-react";

const latestReleases = await getCollection("releases");
latestReleases.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const currentTrack = latestReleases[0];
const artist = currentTrack ? await getEntry(currentTrack.data.artist) : null;
---

<footer
  class="fixed bottom-0 w-full glass-player z-50 h-24 px-6 flex items-center"
>
  <div class="max-w-7xl mx-auto w-full grid grid-cols-3 items-center">
    <!-- Currently Playing -->
    <div class="flex items-center gap-4">
      {
        currentTrack && (
          <>
            <div class="size-14 rounded-lg overflow-hidden border border-white/10 hidden sm:block">
              <Image
                src={currentTrack.data.cover}
                alt={currentTrack.data.title}
                width={100}
                height={100}
                class="w-full h-full object-cover"
              />
            </div>
            <div>
              <h4 class="text-sm font-bold truncate max-w-[120px] sm:max-w-none">
                {currentTrack.data.title}
              </h4>
              <p class="text-[10px] text-slate-500 uppercase tracking-widest">
                {artist?.data.name}
              </p>
            </div>
          </>
        )
      }
      <button class="ml-2 p-1 hover:text-primary transition-colors">
        <IconHeart size={18} stroke={1.5} />
      </button>
    </div>

    <!-- Player Controls -->
    <div class="flex flex-col items-center gap-2">
      <div class="flex items-center gap-6">
        <button class="text-slate-500 hover:text-white transition-colors">
          <IconArrowsShuffle size={20} stroke={1.5} />
        </button>
        <button class="text-slate-300 hover:text-white transition-colors">
          <IconPlayerSkipBack size={20} stroke={1.5} />
        </button>
        <button
          class="size-10 bg-white text-background-dark rounded-full flex items-center justify-center hover:scale-105 transition-transform"
        >
          <IconPlayerPlay size={20} fill="currentColor" />
        </button>
        <button class="text-slate-300 hover:text-white transition-colors">
          <IconPlayerSkipForward size={20} stroke={1.5} />
        </button>
        <button class="text-slate-500 hover:text-white transition-colors">
          <IconRepeat size={20} stroke={1.5} />
        </button>
      </div>
      <div class="w-full flex items-center gap-3">
        <span class="text-[10px] text-slate-500 font-mono">0:00</span>
        <div
          class="flex-1 h-1 bg-white/10 rounded-full relative overflow-hidden group cursor-pointer"
        >
          <div
            class="absolute inset-y-0 left-0 w-0 bg-primary group-hover:bg-secondary transition-colors"
          >
          </div>
          <div
            class="absolute top-1/2 left-0 -translate-y-1/2 size-2 bg-white rounded-full opacity-0 group-hover:opacity-100"
          >
          </div>
        </div>
        <span class="text-[10px] text-slate-500 font-mono">0:00</span>
      </div>
    </div>

    <!-- Volume/Action -->
    <div class="flex items-center justify-end gap-6">
      <div class="hidden lg:flex items-center gap-3">
        <IconVolume size={18} stroke={1.5} />
        <div class="w-24 h-1 bg-white/10 rounded-full">
          <div class="w-2/3 h-full bg-slate-400"></div>
        </div>
      </div>
      <button
        class="flex items-center gap-2 bg-primary/10 border border-primary/20 px-4 py-2 rounded-lg text-primary text-[10px] font-bold uppercase tracking-widest hover:bg-primary/20 transition-all"
      >
        <IconShoppingCart size={14} stroke={2} /> Buy
      </button>
    </div>
  </div>
</footer>
